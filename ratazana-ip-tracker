import requests
import json
import os
import socket
import ipaddress

def limpar_tela():
    """Limpa a tela do terminal"""
    os.system('clear' if os.name == 'posix' else 'cls')

def validar_ip(ip):
    """Valida se Ã© IPv4 ou IPv6 vÃ¡lido"""
    try:
        ipaddress.ip_address(ip)
        return True
    except:
        return False

def obter_informacoes_ip(ip):
    """ObtÃ©m informaÃ§Ãµes de localizaÃ§Ã£o do IP (IPv4 ou IPv6)"""
    try:
        # Tenta API principal primeiro
        url = f"http://ip-api.com/json/{ip}"
        response = requests.get(url, timeout=10)
        
        if response.status_code == 200:
            dados = response.json()
            if dados.get('status') == 'success':
                dados['ip_type'] = 'IPv6' if ':' in ip else 'IPv4'
                return dados
        
        # Se falhar, tenta API alternativa especÃ­fica para IPv6
        if ':' in ip:
            return obter_info_ipv6(ip)
        return None
            
    except:
        return None

def obter_info_ipv6(ipv6):
    """ObtÃ©m informaÃ§Ãµes de IPv6 usando API alternativa"""
    try:
        url = f"https://ipapi.co/{ipv6}/json/"
        response = requests.get(url, timeout=15)
        
        if response.status_code == 200:
            dados = response.json()
            if not dados.get('error'):
                return {
                    'status': 'success',
                    'query': ipv6,
                    'country': dados.get('country_name'),
                    'countryCode': dados.get('country_code'),
                    'regionName': dados.get('region'),
                    'city': dados.get('city'),
                    'zip': dados.get('postal'),
                    'isp': dados.get('org'),
                    'org': dados.get('org'),
                    'lat': dados.get('latitude'),
                    'lon': dados.get('longitude'),
                    'timezone': dados.get('timezone'),
                    'ip_type': 'IPv6'
                }
        return None
    except:
        return None

def obter_ipv6_publico():
    """ObtÃ©m apenas o IPv6 pÃºblico"""
    try:
        response = requests.get('https://api6.ipify.org', timeout=10)
        return response.text.strip()
    except:
        return None

def exibir_informacoes(dados):
    """Exibe as informaÃ§Ãµes formatadas"""
    if not dados:
        print("âŒ NÃ£o foi possÃ­vel obter informaÃ§Ãµes para este IP")
        return
        
    print("â•" * 50)
    print("ğŸŒ INFORMAÃ‡Ã•ES DE LOCALIZAÃ‡ÃƒO")
    print("â•" * 50)
    print(f"ğŸ“¡ IP: {dados.get('query', 'N/A')}")
    print(f"ğŸ”§ Tipo: {dados.get('ip_type', 'N/A')}")
    print(f"ğŸ™ï¸  PaÃ­s: {dados.get('country', 'N/A')}")
    print(f"ğŸ›ï¸  CÃ³digo do PaÃ­s: {dados.get('countryCode', 'N/A')}")
    print(f"ğŸ“ RegiÃ£o: {dados.get('regionName', 'N/A')}")
    print(f"ğŸ¢ Cidade: {dados.get('city', 'N/A')}")
    print(f"ğŸ“® CEP: {dados.get('zip', 'N/A')}")
    print(f"ğŸ“¡ Provedor: {dados.get('isp', 'N/A')}")
    print(f"ğŸŒ OrganizaÃ§Ã£o: {dados.get('org', 'N/A')}")
    print(f"ğŸ§­ Latitude: {dados.get('lat', 'N/A')}")
    print(f"ğŸ§­ Longitude: {dados.get('lon', 'N/A')}")
    print(f"â° Fuso HorÃ¡rio: {dados.get('timezone', 'N/A')}")
    print("â•" * 50)

def main():
    """FunÃ§Ã£o principal"""
    # Verifica dependÃªncias
    try:
        import requests
    except ImportError:
        print("ğŸ“¦ Instalando biblioteca requests...")
        os.system('pip install requests')
        import requests
    
    limpar_tela()
    
    logo = '''

 â–„â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–„   â–„â–„â–„       â–„â–„â–„â–„â–„   â–„â–„â–„â–„â–„â–„   â–„â–„â–„       â–„â–„â–„â–„â–„  
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ–€â–€â–ˆâ–„   â–ˆâ–ˆâ–€â–€â–€â–€â–ˆâ–„ â–ˆâ–ˆâ–€â–€â–€â–€â–ˆâ–„ â–ˆâ–ˆâ–€â–€â–ˆâ–„   â–ˆâ–ˆâ–€â–€â–€â–€â–ˆâ–„ 
 â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ 
 â–ˆâ–ˆâ–ˆâ–€â–€â–ˆâ–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ 
 â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ 
 â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–„â–„â–ˆâ–€   â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–€ â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–€ â–ˆâ–ˆâ–„â–„â–ˆâ–€   â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–€ 
 â–€â–€   â–€â–€   â–€â–€â–€      â–€â–€â–€â–€â–€     â–€â–€â–€â–€â–€    â–€â–€â–€      â–€â–€â–€â–€â–€ 
 
                By:Gustaa
                Insta: gustavo.rtz
 
                   _______________
 
                    VersÃ£o: v2.1
                         ğŸ€ 
                   _______________                  
    '''
    
    print(logo)  
    print("=" * 50)
    
    while True:
        print("\nOpÃ§Ãµes:")
        print("1. Consultar IP especÃ­fico (IPv4/IPv6)")
        print("2. Consultar meu IPv4 atual")  
        print("3. Consultar meu IPv6 atual")
        print("4. Testar IPv6 de exemplo")
        print("5. Sair")
        
        opcao = input("\nEscolha uma opÃ§Ã£o (1-5): ").strip()
        
        if opcao == '1':
            ip = input("\nDigite o IP (IPv4 ou IPv6): ").strip()
            if not validar_ip(ip):
                print("âŒ IP invÃ¡lido!")
                continue
            print(f"\nğŸ” Consultando IP: {ip}...")
            
        elif opcao == '2':
            try:
                ip = requests.get('https://api.ipify.org', timeout=5).text
                print(f"\nğŸ” Consultando seu IPv4: {ip}...")
            except:
                print("âŒ Erro ao obter IPv4.")
                continue
                
        elif opcao == '3':
            ip = obter_ipv6_publico()
            if ip:
                print(f"\nğŸ” Consultando seu IPv6: {ip}...")
            else:
                print("âŒ IPv6 nÃ£o disponÃ­vel ou nÃ£o detectado.")
                continue
                
        elif opcao == '4':
            # IPv6 de exemplo para teste
            ipv6_exemplos = [
                "2001:4860:4860::8888",
                "2606:4700:4700::1111", 
                "2a00:1450:4007:816::200e"
            ]
            print("\nğŸŒ IPv6 de exemplo:")
            for i, ip_ex in enumerate(ipv6_exemplos, 1):
                print(f"{i}. {ip_ex}")
            escolha = input("\nEscolha um (1-3): ").strip()
            if escolha in ['1', '2', '3']:
                ip = ipv6_exemplos[int(escolha)-1]
                print(f"\nğŸ” Consultando IPv6 de teste: {ip}...")
            else:
                print("âŒ OpÃ§Ã£o invÃ¡lida!")
                continue
                
        elif opcao == '5':
            print("ğŸ‘‹ Saindo...")
            break
            
        else:
            print("âŒ OpÃ§Ã£o invÃ¡lida!")
            continue
        
        # ObtÃ©m as informaÃ§Ãµes
        dados = obter_informacoes_ip(ip)
        exibir_informacoes(dados)
        
        # OpÃ§Ã£o do mapa
        if dados and dados.get('lat') and dados.get('lon'):
            ver_mapa = input("\nğŸ—ºï¸  Ver no mapa? (s/n): ").lower()
            if ver_mapa == 's':
                mapa_url = f"https://maps.google.com/?q={dados['lat']},{dados['lon']}"
                print(f"ğŸŒ Abra: {mapa_url}")
        
        input("\nâ Pressione Enter para continuar...")

if __name__ == "__main__":
    main()
