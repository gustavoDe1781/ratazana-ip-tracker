import requests
import json
import os
import socket
import ipaddress

def limpar_tela():
    """Limpa a tela do terminal"""
    os.system('clear' if os.name == 'posix' else 'cls')

def validar_ip(ip):
    """Valida se Ã© IPv4 ou IPv6 vÃ¡lido"""
    try:
        ipaddress.ip_address(ip)
        return True
    except:
        return False

def obter_informacoes_ip(ip):
    """ObtÃ©m informaÃ§Ãµes de localizaÃ§Ã£o do IP (IPv4 ou IPv6)"""
    try:
        # API gratuita para geolocalizaÃ§Ã£o por IP
        url = f"http://ip-api.com/json/{ip}"
        response = requests.get(url, timeout=10)
        
        if response.status_code == 200:
            dados = response.json()
            
            if dados['status'] == 'success':
                return dados
            else:
                # Tenta outra API para IPv6
                if ':' in ip:  # Se for IPv6
                    return obter_info_ipv6(ip)
                return None
        else:
            return None
            
    except requests.exceptions.RequestException:
        return None
    except json.JSONDecodeError:
        return None

def obter_info_ipv6(ipv6):
    """Tenta obter informaÃ§Ãµes de IPv6 usando API alternativa"""
    try:
        url = f"https://ipapi.co/{ipv6}/json/"
        response = requests.get(url, timeout=10)
        
        if response.status_code == 200:
            dados = response.json()
            if 'error' not in dados:
                # Converte para formato similar ao ip-api
                return {
                    'status': 'success',
                    'query': ipv6,
                    'country': dados.get('country_name'),
                    'countryCode': dados.get('country_code'),
                    'regionName': dados.get('region'),
                    'city': dados.get('city'),
                    'zip': dados.get('postal'),
                    'isp': dados.get('org'),
                    'org': dados.get('org'),
                    'lat': dados.get('latitude'),
                    'lon': dados.get('longitude'),
                    'timezone': dados.get('timezone'),
                    'ip_type': 'IPv6'
                }
        return None
    except:
        return None

def obter_ip_publico():
    """ObtÃ©m o IP pÃºblico (IPv4 ou IPv6)"""
    try:
        # Tenta IPv4 primeiro
        response = requests.get('https://api.ipify.org', timeout=5)
        ipv4 = response.text.strip()
        
        # Tenta IPv6
        try:
            response_v6 = requests.get('https://api6.ipify.org', timeout=5)
            ipv6 = response_v6.text.strip()
            return ipv4, ipv6
        except:
            return ipv4, None
            
    except:
        return None, None

def exibir_informacoes(dados):
    """Exibe as informaÃ§Ãµes formatadas"""
    print("â•" * 50)
    print("ğŸŒ INFORMAÃ‡Ã•ES DE LOCALIZAÃ‡ÃƒO")
    print("â•" * 50)
    print(f"ğŸ“¡ IP: {dados.get('query', 'N/A')}")
    print(f"ğŸ”§ Tipo: {dados.get('ip_type', 'IPv4')}")
    print(f"ğŸ™ï¸  PaÃ­s: {dados.get('country', 'N/A')}")
    print(f"ğŸ›ï¸  CÃ³digo do PaÃ­s: {dados.get('countryCode', 'N/A')}")
    print(f"ğŸ“ RegiÃ£o: {dados.get('regionName', 'N/A')}")
    print(f"ğŸ¢ Cidade: {dados.get('city', 'N/A')}")
    print(f"ğŸ“® CEP: {dados.get('zip', 'N/A')}")
    print(f"ğŸ“¡ Provedor: {dados.get('isp', 'N/A')}")
    print(f"ğŸŒ OrganizaÃ§Ã£o: {dados.get('org', 'N/A')}")
    print(f"ğŸ§­ Latitude: {dados.get('lat', 'N/A')}")
    print(f"ğŸ§­ Longitude: {dados.get('lon', 'N/A')}")
    print(f"â° Fuso HorÃ¡rio: {dados.get('timezone', 'N/A')}")
    print("â•" * 50)

def main():
    """FunÃ§Ã£o principal"""
    limpar_tela()
    
    logo = '''

 â–„â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–„   â–„â–„â–„       â–„â–„â–„â–„â–„   â–„â–„â–„â–„â–„â–„   â–„â–„â–„       â–„â–„â–„â–„â–„  
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ–€â–€â–ˆâ–„   â–ˆâ–ˆâ–€â–€â–€â–€â–ˆâ–„ â–ˆâ–ˆâ–€â–€â–€â–€â–ˆâ–„ â–ˆâ–ˆâ–€â–€â–ˆâ–„   â–ˆâ–ˆâ–€â–€â–€â–€â–ˆâ–„ 
 â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ 
 â–ˆâ–ˆâ–ˆâ–€â–€â–ˆâ–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ 
 â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ     â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ     â–ˆâ–ˆ 
 â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–„â–„â–ˆâ–€   â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–€ â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–€ â–ˆâ–ˆâ–„â–„â–ˆâ–€   â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–€ 
 â–€â–€   â–€â–€   â–€â–€â–€      â–€â–€â–€â–€â–€     â–€â–€â–€â–€â–€    â–€â–€â–€      â–€â–€â–€â–€â–€ 
 
                By:Gustaa
                Insta: gustavo.rtz
 
                   _______________
 
                    VersÃ£o: v2.0
                         ğŸ€ 
                   _______________                  
    '''
    
    # Exibe o logo
    print(logo)  
    print("=" * 50)
    
    while True:
        print("\nOpÃ§Ãµes:")
        print("1. Consultar IP especÃ­fico (IPv4/IPv6)")
        print("2. Consultar IP atual")
        print("3. Sair")
        
        opcao = input("\nEscolha uma opÃ§Ã£o (1-3): ").strip()
        
        if opcao == '1':
            ip = input("\nDigite o IP (IPv4 ou IPv6): ").strip()
            
            # ValidaÃ§Ã£o do IP
            if not validar_ip(ip):
                print("âŒ IP invÃ¡lido! Use formato IPv4 (192.168.1.1) ou IPv6 (2001:db8::1)")
                continue
                
            print(f"\nğŸ” Consultando IP: {ip}...")
            
        elif opcao == '2':
            # ObtÃ©m os IPs pÃºblicos
            ipv4, ipv6 = obter_ip_publico()
            
            if ipv4:
                print(f"\nğŸ“¡ Seu IPv4: {ipv4}")
            if ipv6:
                print(f"ğŸ“¡ Seu IPv6: {ipv6}")
                
            if not ipv4 and not ipv6:
                print("âŒ Erro ao obter IP atual.")
                continue
                
            # Pergunta qual IP consultar
            if ipv4 and ipv6:
                escolha = input("\nQual IP deseja consultar? (4=IPv4, 6=IPv6): ").strip()
                ip = ipv6 if escolha == '6' else ipv4
            else:
                ip = ipv4 or ipv6
                
            print(f"\nğŸ” Consultando IP: {ip}...")
                
        elif opcao == '3':
            print("ğŸ‘‹ Saindo...")
            break
            
        else:
            print("âŒ OpÃ§Ã£o invÃ¡lida!")
            continue
        
        # ObtÃ©m as informaÃ§Ãµes do IP
        dados = obter_informacoes_ip(ip)
        
        if dados:
            exibir_informacoes(dados)
            
            # OpÃ§Ã£o para ver no mapa
            if dados.get('lat') and dados.get('lon'):
                ver_mapa = input("\nğŸ—ºï¸  Deseja ver a localizaÃ§Ã£o no mapa? (s/n): ").lower()
                if ver_mapa == 's':
                    lat = dados.get('lat')
                    lon = dados.get('lon')
                    mapa_url = f"https://www.google.com/maps?q={lat},{lon}"
                    print(f"ğŸŒ Abra no navegador: {mapa_url}")
        else:
            print("âŒ Erro ao obter informaÃ§Ãµes do IP")
            print("âš ï¸  Verifique sua conexÃ£o ou tente novamente")

if __name__ == "__main__":
    # Verifica se o requests estÃ¡ instalado
    try:
        import requests
    except ImportError:
        print("ğŸ“¦ Instalando biblioteca requests...")
        os.system('pip install requests')
        import requests
    
    main()
